<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>org.eclipse.emf.ecp</groupId>
	<artifactId>q7-epp-tests</artifactId>
	<packaging>pom</packaging>

	<parent>
		<groupId>org.eclipse.emf.ecp</groupId>
		<artifactId>q7tests</artifactId>
		<version>0.0.1-SNAPSHOT</version>
	</parent>

	<modules>
		<module>update-site</module>
	</modules>
	<properties>
		<emfstore-update-site>http://download.eclipse.org/emf-store/releases_14</emfstore-update-site>
	</properties>
	<profiles>
		<profile>
			<id>q7runner</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<build>
				<plugins>
					<plugin>
						<groupId>com.xored.q7</groupId>
						<artifactId>q7-maven-plugin</artifactId>
						<version>${q7-maven-version}</version>
						<extensions>true</extensions>
						<configuration>
							<q7>
								<version>${q7-runner-version}</version>
								<clientId>jfaltermeier</clientId>
								<clientSecret>2a216714ef4e7dac6237a2eb9c30c57a6d26f81c</clientSecret>
								<organization>EMFClientPlatform</organization>
								<vmArgs>
									<vmArg>-Dhttp.proxyHost=proxy.eclipse.org</vmArg>
									<vmArg>-Dhttp.proxyPort=9898</vmArg>
									<vmArg>-Dhttps.proxyHost=proxy.eclipse.org</vmArg>
									<vmArg>-Dhttps.proxyPort=9898</vmArg>
								</vmArgs>
							</q7>

							<aut>
								<groupId>org.eclipse</groupId>
		    						<artifactId>modeling</artifactId>
		    						<version>${eclipse-version}</version>
								<injections>
									<injection>
										<site>${emfstore-update-site}</site>
										<features>
											<feature>org.eclipse.emf.emfstore.server.feature.feature.group</feature>
											<feature>org.eclipse.emf.emfstore.ecore.feature.feature.group</feature>
											<feature>org.eclipse.emf.emfstore.example.feature.feature.group</feature>
											<feature>org.eclipse.emf.emfstore.client.feature.feature.group</feature>
											<feature>org.eclipse.emf.emfstore.common.feature.feature.group</feature>
											<feature>org.eclipse.emf.emfstore.client.transaction.feature.feature.group</feature>
											<feature>org.eclipse.emf.emfstore.client.ui.feature.feature.group</feature>
										</features>
									</injection>
									<injection>
										<site>https://hudson.eclipse.org/ecp/job/releaseBranch/lastSuccessfulBuild/artifact/releng/org.eclipse.emf.ecp.repository/target/repository/</site>
										<features>
											<feature>org.eclipse.emf.ecp.sdk.feature.feature.group</feature>
										</features>
									</injection>
								</injections>
							</aut>
							<projects>
								<project>${project.basedir}/../project</project>
							</projects>

							<testOptions>
								<execTimeout>7200</execTimeout>
								<testExecTimeout>600</testExecTimeout>
							</testOptions>

						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>

		<profile>
			<id>q7cloud</id>
			<activation>
				<property>
					<name>useCloud</name>
					<value>true</value>
				</property>
			</activation>
			<build>
				<pluginManagement>
					<plugins>
						<plugin>
							<groupId>org.eclipse.tycho.extras</groupId>
							<artifactId>tycho-p2-extras-plugin</artifactId>
							<version>0.20.0</version>
							<executions>
								<execution>
									<phase>generate-resources</phase>
									<goals>
										<goal>mirror</goal>
									</goals>
								</execution>
							</executions>
							<configuration>
								<source>
									<!-- source repositories to mirror from -->
									<repository>
										<url>${emfstore-update-site}</url>
										<layout>p2</layout>
										<!-- supported layouts are "p2-metadata", "p2-artifacts", and "p2" (for joint repositories; default) -->
									</repository>
									<!-- source repositories to mirror from -->
									<repository>
										<url>https://hudson.eclipse.org/ecp/job/releaseBranch/lastSuccessfulBuild/artifact/releng/org.eclipse.emf.ecp.repository/target/repository/</url>
										<layout>p2</layout>
										<!-- supported layouts are "p2-metadata", "p2-artifacts", and "p2" (for joint repositories; default) -->
									</repository>
								</source>

								<!-- starting from here all configuration parameters are optional -->
								<!-- they are only shown here with default values for documentation purpose -->

								<!-- List of IUs to mirror. If omitted, allIUs will be mirrored. -->
								<!-- Omitted IU version element means latest version of the IU -->
								<ius>
									<iu><id>org.eclipse.emf.emfstore.server.feature.feature.group</id></iu>
									<iu><id>org.eclipse.emf.emfstore.ecore.feature.feature.group</id></iu>
									<iu><id>org.eclipse.emf.emfstore.example.feature.feature.group</id></iu>
									<iu><id>org.eclipse.emf.emfstore.client.feature.feature.group</id></iu>
									<iu><id>org.eclipse.emf.emfstore.common.feature.feature.group</id></iu>
									<iu><id>org.eclipse.emf.emfstore.client.transaction.feature.feature.group</id></iu>
									<iu><id>org.eclipse.emf.emfstore.client.ui.feature.feature.group</id></iu>
									<iu><id>org.eclipse.emf.ecp.sdk.feature.feature.group</id></iu>
								</ius>
								<!-- The destination directory to mirror to. -->
								<destination>${project.build.directory}/injections</destination>
								<!-- Whether only strict dependencies should be followed. -->
								<!-- "strict" means perfect version match -->
								<followStrictOnly>false</followStrictOnly>
								<!-- Whether or not to follow optional requirements. -->
								<includeOptional>true</includeOptional>
								<!-- Whether or not to follow non-greedy requirements. -->
								<includeNonGreedy>true</includeNonGreedy>
								<!-- Filter properties. E.g. filter only one platform -->
								<!-- Whether to filter the resulting set of IUs to only -->
								<!-- include the latest version of each IU -->
								<latestVersionOnly>false</latestVersionOnly>
								<!-- don't mirror artifacts, only metadata -->
								<mirrorMetadataOnly>false</mirrorMetadataOnly>
								<!-- whether to compress the content.xml/artifacts.xml -->
								<compress>true</compress>
								<!-- whether to append to the target repository content -->
								<append>true</append>
								<!-- whether to mirror pack200 artifacts also. Available since tycho-extras 0.17.0 -->
								<includePacked>false</includePacked>
							</configuration>
						</plugin>
					</plugins>
				</pluginManagement>
				<plugins>
					<plugin>
						<groupId>com.xored.q7</groupId>
						<artifactId>q7-server-maven-plugin</artifactId>
						<version>${q7-server-maven-version}</version>
						<extensions>true</extensions>
						<configuration>
							<testFailureIgnore>true</testFailureIgnore>
							<metadata>
								<public>true</public>
								<projectName>EMF Client Platform</projectName>
							</metadata>
							<q7client>
								<version>${q7-client-version}</version>
								<clientId>jfaltermeier</clientId>
								<clientSecret>2a216714ef4e7dac6237a2eb9c30c57a6d26f81c</clientSecret>
								<organization>EMFClientPlatform</organization>
								<vmArgs>
									<vmArg>-Dhttp.proxyHost=proxy.eclipse.org</vmArg>
									<vmArg>-Dhttp.proxyPort=9898</vmArg>
									<vmArg>-Dhttps.proxyHost=proxy.eclipse.org</vmArg>
									<vmArg>-Dhttps.proxyPort=9898</vmArg>
								</vmArgs>
							</q7client>
							<q7server>https://cloud.xored.com</q7server>
							<projects>
								<project>${project.basedir}/../project</project>
							</projects>
							<aut>
								<uri>http://maven.xored.com/nexus/content/repositories/q7-releases/org/eclipse/modeling/${eclipse-version}/modeling-${eclipse-version}-[classifier].[ext]</uri>
								<injections>
									<injection>
										<site>file://${project.build.directory}/injections</site>
									</injection>
								</injections>
							</aut>
							<testOptions>
								<execTimeout>7200</execTimeout>
								<testExecTimeout>3600</testExecTimeout>
							</testOptions>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>
</project>
